---
title: "۶. React Fiber — Scheduler"
description: "یاد بگیرید که چگونه React Fiber وظایف رندر بزرگ را به قطعات کوچک‌تر تقسیم می‌کند تا اپ شما نرم و پاسخگو بماند."
---

# ⏳ Scheduler — موتور React Fiber

وقتی state را در React به‌روزرسانی می‌کنید، ممکن است کارهای زیادی اتفاق بیفتد: محاسبه مجدد کامپوننت‌ها، رندر مجدد UI، مدیریت side effect ها…

پس چگونه React حتی با هزاران کامپوننت سریع و نرم می‌ماند؟

🎯 **پاسخ:** React از یک سیستم زمانبندی هوشمند به نام **Fiber** استفاده می‌کند.

---

## 🧠 آنچه یاد خواهید گرفت

- React Fiber چیست و چه مشکلی را حل می‌کند
- چگونه زمانبندی اپ‌ها را سریع نگه می‌دارد
- "interruptible rendering" چه معنایی دارد
- ایده به‌روزرسانی‌های مبتنی بر اولویت
- مثال‌هایی از اینکه چگونه React کار را تقسیم می‌کند

---

## 🔹 Fiber چیست؟

**Fiber** موتور رندر داخلی است که در **React 16** معرفی شد.  
هدف اصلی آن این است که رندر **قابل قطع** و **غیر مسدودکننده** باشد.

> 🧠 قبل از Fiber، به‌روزرسانی‌های React همزمان بودند — یک بار شروع می‌شدند، نمی‌توانستند متوقف شوند.

حالا، Fiber به React اجازه می‌دهد:

- کار را **متوقف** و **ادامه** دهد
- کاری که دیگر مورد نیاز نیست را **لغو** کند
- وظایف فوری (مانند کلیک‌ها) را بر وظایف کند (مانند انیمیشن‌ها) **اولویت‌بندی** کند

---

## 🔄 چرا زمانبندی مهم است؟

این را تصور کنید:

```js
// یک کامپوننت کند
useEffect(() => {
  for (let i = 0; i < 1_000_000_000; i++) {}
}, []);
```

بدون زمانبندی، مرورگر **یخ می‌زند**.

با Fiber، React آن کار را به **قطعات** تقسیم می‌کند، بخش به بخش رندر می‌کند وقتی مرورگر بیکار است — صفحه را **چابک** و **تعاملی** نگه می‌دارد.

---

## ⚙️ چگونه Fiber کار را زمانبندی می‌کند

```css
┌────────────────────────────┐
│ کاربر روی دکمه کلیک می‌کند │
└───────┬────────────────────┘
▼
┌────────────────────────────┐
│ React شروع به رندر می‌کند │
│ - بررسی می‌کند آیا کار فوری است │
│ - به‌روزرسانی‌های بزرگ را به │
│ "واحدهای کار" کوچک تقسیم می‌کند │
└───────┬────────────────────┘
▼
┌────────────────────────────┐
│ مرورگر تعاملی می‌ماند │
│ React در پس‌زمینه کار می‌کند │
└────────────────────────────┘
```

✅ این **concurrent rendering** نامیده می‌شود — React فقط کاری را انجام می‌دهد که **الان** مورد نیاز است، و بقیه را به تعویق می‌اندازد.

---

## 🔸 به‌روزرسانی‌های با اولویت بالا در مقابل پایین

React به طور خودکار **سطوح اولویت** را به به‌روزرسانی‌ها اختصاص می‌دهد:

| مثال                 | اولویت |
| -------------------- | ------ |
| تایپ کردن در input   | بالا   |
| کلیک روی دکمه        | بالا   |
| بارگذاری لیست طولانی | پایین  |
| انیمیشن چیزی         | پایین  |

React **به‌روزرسانی‌های با اولویت بالا را ابتدا زمانبندی می‌کند**، و کار با اولویت پایین را وقتی مرورگر آزاد است انجام می‌دهد.

---

## 🔸 چه زمانی Fiber اجرا می‌شود؟

Fiber هر بار که React این کارها را انجام می‌دهد استفاده می‌شود:

- `setState()`
- به‌روزرسانی‌های `useState()` یا `useReducer()`
- mount یا update کردن کامپوننت
- بارگذاری lazy کامپوننت

React **یک درخت Fiber می‌سازد** و آن را **قطعه به قطعه** رندر می‌کند.

---

## 🧪 تکالیف تمرینی

۱. ✅ یک کامپوننت سنگین با حلقه طولانی در `useEffect()` بسازید — رفتار مسدودکننده را ببینید.
۲. ✅ یک `setTimeout` یا `useTransition` اضافه کنید تا کار را به تأخیر بیندازید و رفتار نرم‌تر را مشاهده کنید.
۳. ✅ `React DevTools Profiler` را بررسی کنید تا زمان‌های رندر و زمانبندی Fiber را ببینید.

---

## 🧠 خلاصه

| مفهوم                  | معنی                                                             |
| ---------------------- | ---------------------------------------------------------------- |
| موتور Fiber            | زمانبند داخلی React از React 16                                  |
| قابل قطع               | می‌تواند رندر را متوقف، تقسیم، لغو کند                           |
| همزمان                 | React می‌تواند به‌روزرسانی‌های سریع را بر وظایف سنگین اولویت دهد |
| UI را سریع نگه می‌دارد | حتی با کامپوننت‌های بزرگ مسدود یا یخ نمی‌زند                     |

---

## 📚 مطالعه بیشتر

- 🔗 [مستندات React — رندر با ویژگی‌های همزمان](https://react.dev/learn/rendering)
- 🔗 [معماری React Fiber](https://github.com/acdlite/react-fiber-architecture)
- 🔗 [یادداشت‌های گروه کاری React در مورد زمانبندی](https://github.com/reactwg)
